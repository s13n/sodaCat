family: LPC865
description: Complete clock tree based on UM11607 Figures 7 & 8
signals:
  - { name: fro_oscout, min: 36000000, max: 60000000 }
  - { name: fro_div2, unit: Hz }
  - { name: fro, unit: Hz }
  - { name: fro_div, unit: Hz }
  - { name: fro_div_wkt, nominal: 750000 }
  - { name: clkin, max: 60000000 }
  - { name: xtalin, max: 25000000 }
  - { name: external_clk, unit: Hz }
  - { name: lp_osc, nominal: 1000000 }
  - { name: pll_in, min: 10000000, max: 25000000 }
  - { name: sys_pll0_clk, max: 100000000 }
  - { name: pll_div_clk, unit: Hz }
  - { name: main_clk_pre_pll, unit: Hz }
  - { name: main_clk, unit: Hz }
  - { name: system_clk, max: 60000000 }
  - { name: adc_clk, unit: Hz }
  - { name: adc_div_clk, unit: Hz }
  - { name: clkout_src, unit: Hz }
  - { name: clkout, unit: Hz }
  - { name: frg0clksel, unit: Hz }
  - { name: frg0clk, unit: Hz }
  - { name: frg1clksel, unit: Hz }
  - { name: frg1clk, unit: Hz }
  - { name: uartclk, unit: Hz }
  - { name: spiclk, unit: Hz }
  - { name: i2cclk, unit: Hz }
  - { name: i3cclk, unit: Hz }
  - { name: lpwr_clk_vulp, nominal: 10000, min: 6000, max: 14000 }
}
sources:
  - name: FRO
    signal: fro_oscout
  - name: CLKIN
    signal: clkin
  - name: XTALIN
    signal: xtalin
    reg: SYSOSCCTRL
    field: BYPASS
  - name: LPOSC
    signal: lp_osc
    reg: LPOSCCTRL
    field: FREQSEL
  - name: ULPOSC
    signal: lpwr_clk_vulp
    reg: DPDCTRL
    field: ULPOSCEN

muxes:
  - name: EXTCLKSEL
    output: external_clk
    inputs: [xtalin, clkin]
    reg: EXTCLKSEL
    field: SEL
  - name: FROOSCCTRL
    output: fro
    inputs: [fro_oscout, fro_div2]
    reg: FROOSCCTRL
    field: FRO_DIRECT
  - name: SYSPLLCLKSEL
    output: pll_in
    inputs: [fro, external_clk, lp_osc, fro_div]
    reg: SYSPLLCLKSEL
    field: SEL
  - name: MAINCLKSEL
    output: main_clk_pre_pll
    inputs: [fro, external_clk, lp_osc, fro_div]
    reg: MAINCLKSEL
    field: SEL
  - name: MAINCLKPLLSEL
    output: main_clk
    inputs: [main_clk_pre_pll, sys_pll0_clk, "", ""]
    reg: MAINCLKPLLSEL
    field: SEL
  - name: CLKOUTSEL
    output: clkout_src
    inputs: [fro, main_clk, pll_div_clk, external_clk, lp_osc, "", "", ""]
    reg: CLKOUTSEL
    field: SEL
  - name: ADCCLKSEL
    output: adc_clk
    inputs: [fro, pll_div_clk, "", ""]
    reg: ADCCLKSEL
    field: SEL
  - name: FRG0CLKSEL
    output: frg0clksel
    inputs: [fro, main_clk, pll_div_clk, ""]
    reg: FRG0CLKSEL
    field: SEL
  - name: FRG1CLKSEL
    output: frg1clksel
    inputs: [fro, main_clk, pll_div_clk, ""]
    reg: FRG1CLKSEL
    field: SEL
  - name: UART0CLKSEL
    output: uart0clk
    inputs: [fro, main_clk, frg0clk, frg1clk, fro_div, "", "", ""]
    reg: UART0CLKSEL
    field: SEL
  - name: UART1CLKSEL
    output: uart1clk
    inputs: [fro, main_clk, frg0clk, frg1clk, fro_div, "", "", ""]
    reg: UART1CLKSEL
    field: SEL
  - name: UART2CLKSEL
    output: uart2clk
    inputs: [fro, main_clk, frg0clk, frg1clk, fro_div, "", "", ""]
    reg: UART2CLKSEL
    field: SEL
  - name: SPI0CLKSEL
    output: spi0clk
    inputs: [fro, main_clk, frg0clk, frg1clk, fro_div, "", "", ""]
    reg: SPI0CLKSEL
    field: SEL
  - name: SPI1CLKSEL
    output: spi1clk
    inputs: [fro, main_clk, frg0clk, frg1clk, fro_div, "", "", ""]
    reg: SPI1CLKSEL
    field: SEL
  - name: I2C0CLKSEL
    output: i2c0clk
    inputs: [fro, main_clk, frg0clk, frg1clk, fro_div, "", "", ""]
    reg: I2C0CLKSEL
    field: SEL
  - name: I3CCLKSEL
    output: i3cclk
    inputs: [fro, main_clk, pll_div_clk]
    reg: I3CCLKSEL
    field: SEL
  - name: wkt_mux_int
    field: CLKSEL
    reg: WKT_CTRL
    inputs: [fro_div_wkt, lpwr_clk_vulp]
    output: wkt_int_clk
  - name: wkt_mux_ext
    field: SEL_EXTCLK
    reg: WKT_CTRL
    inputs: [wkt_int_clk, wktclkin]
    output: wkt_counter_clk

plls:
  - name: SYSPLL
    input: pll_in
    output: sys_pll0_clk
    regs:
      - { reg: SYSPLLCTRL, field: MSEL }
      - { reg: SYSPLLCTRL, field: PSEL }
      - { reg: SYSPLLSTAT, field: LOCK }

dividers:
  - name: FRO_HALF_DIV
    input: fro_oscout
    output: fro_div2
    divisor: 2
  - name: FRO_DIV
    input: fro
    output: fro_div
    divisor: 2
  - name: FRO_DIV_WKT
    input: fro
    output: fro_div_wkt
    divisor: 16
    description: Divider in the WKT block
  - name: SYSPLLDIV
    input: sys_pll0_clk
    output: pll_div_clk
    reg: SYSPLLDIV
    field: DIV
  - name: SYSAHBCLKDIV
    input: main_clk
    output: system_clk
    reg: SYSAHBCLKDIV
    field: DIV
  - name: ADCCLKDIV
    input: adc_clk
    output: adc_div_clk
    reg: ADCCLKDIV
    field: DIV
  - name: CLKOUTDIV
    input: clkout_src
    output: clkout
    reg: CLKOUTDIV
    field: DIV
  - name: FRG0
    input: frg0clksel
    output: frg0clk
    regs:
      - { reg: FRG0DIV, field: DIV }
      - { reg: FRG0MULT, field: MULT }
  - name: FRG1
    input: frg1clksel
    output: frg1clk
    regs:
      - { reg: FRG1DIV, field: DIV }
      - { reg: FRG1MULT, field: MULT }

gates:
  - name: ROMCLK
    output: romclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: ROM
  - name: RAMCLK
    output: ramclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: RAM
  - name: FLASHCLK
    output: flashclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: FLASH
  - name: I2C0CLK
    output: fclk5
    input: i2c0clk
    reg: SYSAHBCLKCTRL0
    field: I2C0
  - name: GPIO0CLK
    output: gpio0clk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: GPIO0
  - name: SWMCLK
    output: swmclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: SWM
  - name: WKTCLK
    output: wktclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: WKT
  - name: MRTCLK
    output: mrtclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: MRT
  - name: SPI0CLK
    output: fclk9
    input: spi0clk
    reg: SYSAHBCLKCTRL0
    field: SPI0
  - name: SPI1CLK
    output: fclk10
    input: spi1clk
    reg: SYSAHBCLKCTRL0
    field: SPI1
  - name: CRCCLK
    output: crcclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: CRC
  - name: UART0CLK
    output: fclk0
    input: uart0clk
    reg: SYSAHBCLKCTRL0
    field: UART0
  - name: UART1CLK
    output: fclk1
    input: uart1clk
    reg: SYSAHBCLKCTRL0
    field: UART1
  - name: UART2CLK
    output: fclk2
    input: uart2clk
    reg: SYSAHBCLKCTRL0
    field: UART2
  - name: WWDTCLK
    output: wwdtclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: WWDT
  - name: IOCONCLK
    output: ioconclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: IOCON
  - name: ACMPCLK
    output: acmpclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: ACMP
  - name: GPIO1CLK
    output: gpio1clk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: GPIO1
  - name: FTM0CLK
    output: ftm0clk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: FTM0
  - name: FTM1CLK
    output: ftm1clk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: FTM1
  - name: I3CCLK
    output: i3cclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: I3C
  - name: ADC
    output: adc_sclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: ADC
  - name: GPIOINTCLK
    output: gpiointclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: GPIO_INT
  - name: DMACLK
    output: dmaclk
    input: system_clk
    reg: SYSAHBCLKCTRL0
    field: DMA
