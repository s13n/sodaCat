version: 1.0.0
family: STM32H7
devices:
  - STM32H745
  - STM32H755
  - STM32H747
  - STM32H757
documents:
  - id: RM0399
    title: STM32H745/755 and STM32H747/757 advanced Arm-based 32-bit MCUs
    revision: Rev.4
notes:
  - "Clock sources: HSI, CSI (~4 MHz), HSE (4\u201348 MHz), LSE (32.768 kHz), LSI (~32 kHz), HSI48 (48 MHz)."
  - 'System clock sources: HSE, HSI, CSI, or PLL1_P via RCC_CFGR.SW.'
  - "PLL ref (after DIVM) 1\u201316 MHz; \u03A3\u0394 fractional supported; VCO ranges per VCOSEL."
instance: RCC
signals:
  - name: hsi_ck
    description: High-speed internal RC; can feed SYSCLK and PLL.
  - name: csi_ck
    description: Low-power internal RC (~4 MHz); can feed SYSCLK and PLL.
  - name: hse_ck
    description: "External high-speed crystal/clock (4\u201348 MHz). For external clock, set RCC_CR.HSEBYP and drive OSC_IN (bypass)."
  - name: lse_ck
    description: Low-speed external 32.768 kHz in backup domain. For bypass mode, use RCC_BDCR.LSEBYP.
  - name: lsi_ck
    description: Low-speed internal RC (~32 kHz), for IWDG/RTC as selected.
  - name: hsi48_ck
    description: 48 MHz internal RC (USB and others, device-dependent).
  - name: ref1_ck
    description: "PLL1 reference after DIVM1 (must be 1\u201316 MHz)."
  - name: ref2_ck
    description: PLL2 reference after DIVM2.
  - name: ref3_ck
    description: PLL3 reference after DIVM3.
  - name: vco1_ck
    description: "PLL1 VCO (integer/fractional \u03A3\u0394; FRAC update on-the-fly)."
  - name: pll1_p_ck
    description: PLL1 'P' output; can feed SYSCLK.
  - name: pll1_q_ck
    description: PLL1 'Q' output (kernel clocks).
  - name: pll1_r_ck
    description: PLL1 'R' output (e.g., TRACE).
  - name: vco2_ck
    description: PLL2 VCO; same constraints as PLL1.
  - name: pll2_p_ck
    description: PLL2 'P' output.
  - name: pll2_q_ck
    description: PLL2 'Q' output.
  - name: pll2_r_ck
    description: PLL2 'R' output.
  - name: vco3_ck
    description: PLL3 VCO; same constraints as PLL1/2.
  - name: pll3_p_ck
    description: PLL3 'P' output.
  - name: pll3_q_ck
    description: PLL3 'Q' output.
  - name: pll3_r_ck
    description: PLL3 'R' output.
  - name: sys_ck
    description: System clock; switch occurs only when target is ready.
  - name: sys_d1cpre_ck
    description: D1 domain prescaled CPU clock.
  - name: sys_hpre_ck
    description: AXI/AHB bus matrix clock
  - name: mco1_src_ck
    description: MCO1 source selection.
  - name: mco1_ck
    description: MCO1 output clock after prescaler.
  - name: mco2_src_ck
    description: MCO2 source selection.
  - name: mco2_ck
    description: MCO2 output clock after prescaler.
  - name: pllsrc_mux_out_ck
    description: Output of PLLSRC_mux feeding DIVM1/2/3.
  - name: rcc_c1_ck
    description: CPU1 clock (i.e. Cortex-M7)
  - name: rcc_c2_ck
    description: CPU2 clock (i.e. Cortex-M4)
  - name: rcc_fclk_c1
    description: CPU1 function clock for systick timer
  - name: rcc_fclk_c2
    description: CPU2 function clock for systick timer
  - name: rcc_aclk
    description: AXI peripheral clock
  - name: rcc_hclk1
    description: AHB1 peripheral clock (domain D2)
  - name: rcc_hclk2
    description: AHB2 peripheral clock (domain D2) 
  - name: rcc_hclk3
    description: AHB3 peripheral clock (domain D1) 
  - name: rcc_hclk4
    description: AHB4 peripheral clock (domain D3)
  - name: rcc_pclk1
    description: APB1 peripheral clock (domain D2)
  - name: rcc_pclk2
    description: APB2 peripheral clock (domain D2)
  - name: rcc_pclk3
    description: APB3 peripheral clock (domain D1)
  - name: rcc_pclk4
    description: APB4 peripheral clock (domain D3)
  - name: rcc_rtc_ck
    description: RTC/AWU kernel clock
  - name: per_ck
    description: global peripheral clock
  - name: i2s_ckin
    description: audio master clock input (I2S_CKIN pin function)
  - name: dsi_phy_ck
    description: DSI PHY clock input (max. 62 MHz)
  - name: dma1_hclk
    description: Host clock for DMA1
  - name: adc12_bus_ck
    description: Bus clock for ADC1 and ADC2
  - name: usb1otg_bus_ck
    description: Bus clock for USB1OTG
  - name: eth1mac_bus_ck
    description: Bus clock for ETH1MAC
  - name: eth1tx_ck
    description: Transmit clock for ETH1MAC
  - name: eth1rx_ck
    description: Receive clock for ETH1MAC
  - name: sai4_a_ker_ck
    description: SAI4a kernel clock (max. 150 MHz)
  - name: sai4_b_ker_ck
    description: SAI4b kernel clock (max. 150 MHz)
  - name: sai3_ker_ck
    description: SAI3 kernel clock (max. 150 MHz)
  - name: sai2_ker_ck
    description: SAI2 kernel clock (max. 150 MHz)
  - name: sai1_ker_ck
    description: SAI1 kernel clock (max. 150 MHz)
  - name: dfsdm_ck
    description: DFSDM kernel clock (max. 250 MHz)
  - name: dfsdm_ack
    description: DFSDM kernel clock (max. 250 MHz)
  - name: spdifrx_ker_ck
    description: SPDIF receiver kernel clock (max. 250 MHz)
  - name: spi1_ker_ck
    description: SPI1 kernel clock (max. 200 MHz)
  - name: spi2_ker_ck
    description: SPI2 kernel clock (max. 200 MHz)
  - name: spi3_ker_ck
    description: SPI3 kernel clock (max. 200 MHz)
  - name: spi4_ker_ck
    description: SPI4 kernel clock (max. 125 MHz)
  - name: spi5_ker_ck
    description: SPI5 kernel clock (max. 125 MHz)
  - name: spi6_ker_ck
    description: SPI6 kernel clock (max. 125 MHz)
  - name: i2c1_ker_ck
    description: I2C1 kernel clock (max. 125 MHz)
  - name: i2c2_ker_ck
    description: I2C2 kernel clock (max. 125 MHz)
  - name: i2c3_ker_ck
    description: I2C3 kernel clock (max. 125 MHz)
  - name: i2c4_ker_ck
    description: I2C4 kernel clock (max. 125 MHz)
  - name: usart1_ker_ck
    description: USART1 kernel clock (max. 125 MHz)
  - name: usart2_ker_ck
    description: USART2 kernel clock (max. 125 MHz)
  - name: usart3_ker_ck
    description: USART3 kernel clock (max. 125 MHz)
  - name: uart4_ker_ck
    description: UART4 kernel clock (max. 125 MHz)
  - name: uart5_ker_ck
    description: UART5 kernel clock (max. 125 MHz)
  - name: usart6_ker_ck
    description: USART6 kernel clock (max. 125 MHz)
  - name: uart7_ker_ck
    description: UART7 kernel clock (max. 125 MHz)
  - name: uart8_ker_ck
    description: UART8 kernel clock (max. 125 MHz)
  - name: lpuart_ker_ck
    description: LPUSART kernel clock (max. 125 MHz)
  - name: lptim1_ker_ck
    description: LPTIM1 kernel clock (max. 125 MHz)
  - name: lptim2_ker_ck
    description: LPTIM2 kernel clock (max. 125 MHz)
  - name: lptim345_ker_ck
    description: LPTIM3,4,5 selected kernel clock (max. 125 MHz)
  - name: lptim3_ker_ck
    description: LPTIM3 kernel clock (max. 125 MHz)
  - name: lptim4_ker_ck
    description: LPTIM4 kernel clock (max. 125 MHz)
  - name: lptim5_ker_ck
    description: LPTIM5 kernel clock (max. 125 MHz)
  - name: ltdc_ker_ck
    description: LTDC kernel clock (max. 150 MHz)
  - name: blclk_ck
    description: BLCLK kernel clock (DSI, max. 133 MHz)
  - name: sdmmc1_ker_ck
    description: SDMMC1 kernel clock (max. 250 MHz)
  - name: sdmmc2_ker_ck
    description: SDMMC2 kernel clock (max. 250 MHz)
  - name: quadspi_ker_ck
    description: QUADSPI kernel clock (max. 250 MHz)
  - name: fmc_ker_ck
    description: FMC kernel clock (max. 300 MHz)
  - name: adc3_ker_ck
    description: ADC3 kernel clock (max. 80 MHz)
  - name: adc12_ker_ck
    description: ADC1/2 kernel clock (max. 80 MHz)
  - name: swpmi_ker_ck
    description: SWPMI kernel clock (max. 125 MHz)
  - name: rng_ker_ck
    description: RNG kernel clock (max. 250 MHz)
  - name: fdcan_ker_ck
    description: FDCAN kernel clock (max. 125 MHz)
  - name: cec_ker_ck
    description: CEC kernel clock (HDMI, max. 66 MHz)
generators:
  - name: HSI
    output: hsi_ck
    description: Internal high-speed RC.
    control:
      reg: CR
      field: HSIDIV
      values: [64000000, 32000000, 16000000, 8000000]
      default: 64000000
  - name: CSI
    output: csi_ck
    description: Internal ~4 MHz RC.
    control:
      reg: CR
      field: CSION
      default: 4000000
  - name: HSE
    output: hse_ck
    description: "External/crystal 4..48 MHz."
    control:
      state: stateHSE
      reg: CR
      field: HSEON
      default: 12000000
  - name: LSE
    output: lse_ck
    description: External 32.768 kHz.
    control:
      state: stateLSE
      reg: BDCR
      field: LSEON
      default: 32768
  - name: LSI
    output: lsi_ck
    description: Internal ~32 kHz RC.
    control:
      reg: CSR
      field: LSION
      default: 32000
  - name: HSI48
    output: hsi48_ck
    description: Internal 48 MHz RC.
    control:
      reg: CR
      field: RC48ON
      default: 48000000
muxes:
  - name: PLLSRC_mux
    output: pllsrc_mux_out_ck
    inputs:
      - hsi_ck
      - csi_ck
      - hse_ck
      - ""
    control:
      inputs:
        - hsi_ck
        - csi_ck
        - hse_ck
        - ""
      reg: PLLCKSELR
      field: PLLSRC
      notes: Set '11' (none) if no PLL is used to save power.
    description: Common PLL source selection feeding DIVM1/2/3.
  - name: SYSCLK_mux
    output: sys_ck
    inputs:
      - hsi_ck
      - csi_ck
      - hse_ck
      - pll1_p_ck
    control:
      inputs:
        - hsi_ck
        - csi_ck
        - hse_ck
        - pll1_p_ck
      reg: CFGR
      field: SW
    description: System clock source selection (status in CFGR.SWS).
  - name: LPTIM345SEL
    output: lptim345_ker_ck
    inputs:
      - rcc_pclk4
      - pll2_p_ck
      - pll3_r_ck
      - lse_ck
      - lsi_ck
      - per_ck
      - ""
      - ""
    control:
      reg: D3CCIPR
      field: LPTIM345SRC
    description: LPTIM3,4,5 kernel clock source selection.
plls:
  - name: PLL1
    input: ref1_ck
    output: vco1_ck
    feedback_integer:
      reg: PLL1DIVR
      field: DIVN1
      value_range:
        min: 8
        max: 432
        offset: -1
    feedback_fraction:
      reg: PLL1FRACR
      field: FRACN1
      value_range:
        min: 0
        max: 8191
        scale: 8192
    vco_limits:
      min: 192000000
      max: 960000000
    description: "Main PLL for CPU and high-speed peripherals"  
  - name: PLL2
    input: ref2_ck
    output: vco2_ck
    feedback_integer:
      reg: PLL2DIVR
      field: DIVN2
      value_range:
        min: 8
        max: 432
        offset: -1
    feedback_fraction:
      reg: PLL2FRACR
      field: FRACN2
      value_range:
        min: 0
        max: 8191
        scale: 8192
    vco_limits:
      min: 192000000
      max: 960000000
    description: "Dedicated PLL for peripherals"  
  - name: PLL3
    input: ref3_ck
    output: vco3_ck
    feedback_integer:
      reg: PLL3DIVR
      field: DIVN3
      value_range:
        min: 8
        max: 432
        offset: -1
    feedback_fraction:
      reg: PLL3FRACR
      field: FRACN3
      value_range:
        min: 0
        max: 8191
        scale: 8192
    vco_limits:
      min: 192000000
      max: 960000000
    description: "Dedicated PLL for peripherals"  
dividers:
  - name: DIVM1
    input: pllsrc_mux_out_ck
    output: ref1_ck
    control:
      reg: PLLCKSELR
      field: DIVM1
      range: '[1..63]'
    description: "PLL1 pre-divider; ensures 1\u201316 MHz at ref1_ck."
  - name: DIVM2
    input: pllsrc_mux_out_ck
    output: ref2_ck
    control:
      reg: PLLCKSELR
      field: DIVM2
      range: '[1..63]'
    description: PLL2 pre-divider.
  - name: DIVM3
    input: pllsrc_mux_out_ck
    output: ref3_ck
    control:
      reg: PLLCKSELR
      field: DIVM3
      range: '[1..63]'
    description: PLL3 pre-divider.
  - name: PLL1_DIVP
    input: vco1_ck
    output: pll1_p_ck
    control:
      reg: PLL1DIVR
      field: PLL1P
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVP1EN.
    description: PLL1 P output divider.
  - name: PLL1_DIVQ
    input: vco1_ck
    output: pll1_q_ck
    control:
      reg: PLL1DIVR
      field: PLL1Q
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVQ1EN.
    description: PLL1 Q output divider.
  - name: PLL1_DIVR
    input: vco1_ck
    output: pll1_r_ck
    control:
      reg: PLL1DIVR
      field: PLL1R
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVR1EN.
    description: PLL1 R output divider.
  - name: PLL2_DIVP
    input: vco2_ck
    output: pll2_p_ck
    control:
      reg: PLL2DIVR
      field: PLL2P
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVP2EN.
    description: PLL2 P output divider.
  - name: PLL2_DIVQ
    input: vco2_ck
    output: pll2_q_ck
    control:
      reg: PLL2DIVR
      field: PLL2Q
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVQ2EN.
    description: PLL2 Q output divider.
  - name: PLL2_DIVR
    input: vco2_ck
    output: pll2_r_ck
    control:
      reg: PLL2DIVR
      field: PLL2R
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVR2EN.
    description: PLL2 R output divider.
  - name: PLL3_DIVP
    input: vco3_ck
    output: pll3_p_ck
    control:
      reg: PLL3DIVR
      field: PLL3P
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVP3EN.
    description: PLL3 P output divider.
  - name: PLL3_DIVQ
    input: vco3_ck
    output: pll3_q_ck
    control:
      reg: PLL3DIVR
      field: PLL3Q
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVQ3EN.
    description: PLL3 Q output divider.
  - name: PLL3_DIVR
    input: vco3_ck
    output: pll3_r_ck
    control:
      reg: PLL3DIVR
      field: PLL3R
      range: '[2..128]'
      notes: Enable with RCC_PLLCFGR.DIVR3EN.
    description: PLL3 R output divider.
  - name: D1CPRE
    input: sys_ck
    output: sys_d1cpre_ck
    factor:
      reg: D1CFGR
      field: D1CPRE
      factor:
      - 1
      - 2
      - 4
      - 8
      - 16
      - 64
      - 128
      - 256
      - 512
    description: CPU1 prescaler (D1 domain).
  - name: HPRE
    input: sys_d1cpre_ck
    output: sys_hpre_ck
    factor:
      reg: D1CFGR
      field: HPRE
      factors:
      - 1
      - 2
      - 4
      - 8
      - 16
    description: AXI/AHB bus matrix prescaler.
  - name: D1PPRE
    input: sys_hpre_ck
    output: rcc_pclk3
    factor:
      reg: D1CFGR
      field: D1PPRE
      factors:
      - 1
      - 2
      - 4
      - 8
      - 16
    description: APB3 prescaler.
  - name: D2PPRE1
    input: sys_hpre_ck
    output: rcc_pclk1
    factor:
      reg: D2CFGR
      field: D2PPRE1
      factors:
      - 1
      - 2
      - 4
      - 8
      - 16
    description: APB1 prescaler.
  - name: D2PPRE2
    input: sys_hpre_ck
    output: rcc_pclk2
    factor:
      reg: D2CFGR
      field: D2PPRE2
      factors:
      - 1
      - 2
      - 4
      - 8
      - 16
    description: APB2 prescaler.
  - name: D3PPRE
    input: sys_hpre_ck
    output: rcc_pclk4
    factor:
      reg: D3CFGR
      field: D3PPRE
      factors:
      - 1
      - 1
      - 1
      - 1
      - 2
      - 4
      - 8
      - 16
    description: D3 domain APB4 prescaler.
  - name: MCO1PRE
    input: mco1_src_ck
    output: mco1_ck
    factor:
      reg: CFGR
      field: MCO1PRE
      range: '[1..15]'
    description: MCO1 prescaler.
  - name: MCO2PRE
    input: mco2_src_ck
    output: mco2_ck
    factor:
      reg: CFGR
      field: MCO2PRE
      range: '[1..15]'
    description: MCO2 prescaler.
gates:
  - name: DMA1EN
    output: dma1_hclk
    input: rcc_hclk1
    control:
      reg: C[0].AHB1ENR
      field: DMA1EN
    description: DMA1 bus interface clock gate (AHB1).
  - name: ADC12EN
    output: adc12_bus_ck
    input: rcc_hclk1
    control:
      reg: C[0].AHB1ENR
      field: ADC12EN
    description: ADC1/2 bus interface clock gate; ADC kernel clock selected separately.
  - name: USB1OTGEN
    output: usb1otg_bus_ck
    input: rcc_hclk1
    control:
      reg: C[0].AHB1ENR
      field: USB1OTGEN
    description: USB1 OTG HS peripheral bus clock gate.
  - name: ETH1MACEN
    output: eth1mac_bus_ck
    input: rcc_hclk1
    control:
      reg: C[0].AHB1ENR
      field: ETH1MACEN
    description: Ethernet MAC bus interface clock gate.
  - name: ETH1TXEN
    output: eth1tx_ck
    input: rcc_hclk1
    control:
      reg: C[0].AHB1ENR
      field: ETH1TXEN
    description: Ethernet TX clock gate.
  - name: ETH1RXEN
    output: eth1rx_ck
    input: rcc_hclk1
    control:
      reg: C[0].AHB1ENR
      field: ETH1RXEN
    description: Ethernet RX clock gate.
  - name: LPTIM3EN
    output: lptim3_ker_ck
    input: lptim345_ker_ck
    control:
      reg: C[0].APB4ENR
      field: LPTIM3EN
    description: Ethernet RX clock gate.
  - name: LPTIM4EN
    output: lptim4_ker_ck
    input: lptim345_ker_ck
    control:
      reg: C[0].APB4ENR
      field: LPTIM4EN
    description: Ethernet RX clock gate.
  - name: LPTIM5EN
    output: lptim5_ker_ck
    input: lptim345_ker_ck
    control:
      reg: C[0].APB4ENR
      field: LPTIM5EN
    description: Ethernet RX clock gate.
