name: SPDIFRX
description: SPDIF receiver interface
source: STM32H7S SVD v1.3
registers:
  - name: CR
    displayName: CR
    description: Control register
    addressOffset: 0
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: SPDIFRXEN
        description: "Peripheral block enable<sup>(1)</sup>\nThis field is modified by software. \nIt must be used to change the peripheral phase among the three possible states: STATE_IDLE, STATE_SYNC and STATE_RCV.\nIt is not possible to transition from STATE_RCV to STATE_SYNC, the user must first go the STATE_IDLE.\nNote: it is possible to transition from STATE_IDLE to STATE_RCV: in that case the peripheral transitions from STATE_IDLE to STATE_SYNC and as soon as the synchronization is performed goes to STATE_RCV."
        bitOffset: 0
        bitWidth: 2
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Disable SPDIFRX (STATE_IDLE).
            value: 0
          - name: B_0x1
            description: Enable SPDIFRX synchronization only.
            value: 1
          - name: B_0x2
            description: FIELD Reserved
            value: 2
          - name: B_0x3
            description: Enable SPDIF receiver.
            value: 3
      - name: RXDMAEN
        description: "Receiver DMA enable for data flow<sup>(1)</sup>\nThis bit is set/reset by software.\nNote: When this bit is set, the DMA request is made whenever the RXNE flag is set."
        bitOffset: 2
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: DMA mode is enabled for reception.
            value: 1
          - name: B_0x0
            description: DMA mode is disabled for reception.
            value: 0
      - name: RXSTEO
        description: "Stereo mode<sup>(1)</sup>\nThis bit is set/reset by software.\nNote: This bit is used in case of overrun situation in order to handle misalignment."
        bitOffset: 3
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The peripheral is in stereo mode.
            value: 1
          - name: B_0x0
            description: The peripheral is in mono mode.
            value: 0
      - name: DRFMT
        description: "RX data format<sup>(1)</sup>\nThis bit is set/reset by software."
        bitOffset: 4
        bitWidth: 2
        access: read-write
        enumeratedValues:
          - name: B_0x3
            description: FIELD Reserved
            value: 3
          - name: B_0x2
            description: Data sample are packed by setting two 16-bit sample into a 32-bit word.
            value: 2
          - name: B_0x1
            description: Data samples are aligned in the left (MSB)
            value: 1
          - name: B_0x0
            description: Data samples are aligned in the right (LSB).
            value: 0
      - name: PMSK
        description: "Mask parity error bit<sup>(1)</sup>\nThis bit is set/reset by software."
        bitOffset: 6
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The parity error bit is not copied into the SPDIFRX_FMTx_DR, a zero is written instead.
            value: 1
          - name: B_0x0
            description: The parity error bit is copied into the SPDIFRX_FMTx_DR.
            value: 0
      - name: VMSK
        description: "Mask of validity bit<sup>(1)</sup>\nThis bit is set/reset by software."
        bitOffset: 7
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The validity bit is not copied into the SPDIFRX_FMTx_DR, a zero is written instead.
            value: 1
          - name: B_0x0
            description: The validity bit is copied into the SPDIFRX_FMTx_DR.
            value: 0
      - name: CUMSK
        description: "Mask of channel status and user bits<sup>(1)</sup>\nThis bit is set/reset by software."
        bitOffset: 8
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The channel status and user bits are not copied into the SPDIFRX_FMTx_DR, zeros are written instead.
            value: 1
          - name: B_0x0
            description: The channel status and user bits are copied into the SPDIFRX_FMTx_DR.
            value: 0
      - name: PTMSK
        description: "Mask of preamble type bits<sup>(1)</sup>\nThis bit is set/reset by software."
        bitOffset: 9
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The preamble type bits are not copied into the SPDIFRX_FMTx_DR, zeros are written instead.
            value: 1
          - name: B_0x0
            description: The preamble type bits are copied into the SPDIFRX_FMTx_DR.
            value: 0
      - name: CBDMAEN
        description: "Control buffer DMA enable for control flow<sup>(1)</sup>\nThis bit is set/reset by software.\nNote: When this bit is set, the DMA request is made whenever the CSRNE flag is set."
        bitOffset: 10
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: DMA mode is enabled for reception of channel status and used data information.
            value: 1
          - name: B_0x0
            description: DMA mode is disabled for reception of channel status and used data information.
            value: 0
      - name: CHSEL
        description: "Channel selection<sup>(1)</sup>\nThis bit is set/reset by software."
        bitOffset: 11
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The control flow takes the channel status from channel B.
            value: 1
          - name: B_0x0
            description: The control flow takes the channel status from channel A.
            value: 0
      - name: NBTR
        description: Maximum allowed re-tries during synchronization phase<sup>(1)</sup>
        bitOffset: 12
        bitWidth: 2
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: No re-try is allowed (only one attempt)
            value: 0
          - name: B_0x1
            description: 3 re-tries allowed
            value: 1
          - name: B_0x2
            description: 15 re-tries allowed
            value: 2
          - name: B_0x3
            description: 63 re-tries allowed
            value: 3
      - name: WFA
        description: "Wait for activity<sup>(1)</sup>\nThis bit is set/reset by software."
        bitOffset: 14
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The SPDIFRX waits for activity on SPDIFRX_IN line (4 transitions) before performing the synchronization.
            value: 1
          - name: B_0x0
            description: The SPDIFRX does not wait for activity on SPDIFRX_IN line before performing the synchronization.
            value: 0
      - name: INSEL
        description: "SPDIFRX input selection\nother: reserved"
        bitOffset: 16
        bitWidth: 3
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: SPDIFRX_IN1 selected
            value: 0
          - name: B_0x1
            description: SPDIFRX_IN2 selected
            value: 1
          - name: B_0x2
            description: SPDIFRX_IN3 selected
            value: 2
          - name: B_0x3
            description: SPDIFRX_IN4 selected
            value: 3
      - name: CKSEN
        description: "Symbol clock enable\nThis bit is set/reset by software."
        bitOffset: 20
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The SPDIFRX generates a symbol clock.
            value: 1
          - name: B_0x0
            description: The SPDIFRX does not generate a symbol clock.
            value: 0
      - name: CKSBKPEN
        description: "Backup symbol clock enable\nThis bit is set/reset by software."
        bitOffset: 21
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x1
            description: The SPDIFRX generates a backup symbol clock if CKSEN = 1.
            value: 1
          - name: B_0x0
            description: The SPDIFRX does not generate a backup symbol clock.
            value: 0
  - name: IMR
    displayName: IMR
    description: Interrupt mask register
    addressOffset: 4
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: RXNEIE
        description: "RXNE interrupt enable\nThis bit is set and cleared by software."
        bitOffset: 0
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Interrupt is inhibited.
            value: 0
          - name: B_0x1
            description: A SPDIFRX interface interrupt is generated whenever RXNE=1 in the SPDIFRX_SR register.
            value: 1
      - name: CSRNEIE
        description: "Control buffer ready interrupt enable\nThis bit is set and cleared by software."
        bitOffset: 1
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Interrupt is inhibited.
            value: 0
          - name: B_0x1
            description: A SPDIFRX interface interrupt is generated whenever CSRNE = 1 in the SPDIFRX_SR register.
            value: 1
      - name: PERRIE
        description: "Parity error interrupt enable\nThis bit is set and cleared by software."
        bitOffset: 2
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Interrupt is inhibited.
            value: 0
          - name: B_0x1
            description: A SPDIFRX interface interrupt is generated whenever PERR=1 in the SPDIFRX_SR register.
            value: 1
      - name: OVRIE
        description: "Overrun error interrupt enable\nThis bit is set and cleared by software."
        bitOffset: 3
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Interrupt is inhibited.
            value: 0
          - name: B_0x1
            description: A SPDIFRX interface interrupt is generated whenever OVR=1 in the SPDIFRX_SR register.
            value: 1
      - name: SBLKIE
        description: "Synchronization block detected interrupt enable\nThis bit is set and cleared by software."
        bitOffset: 4
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Interrupt is inhibited.
            value: 0
          - name: B_0x1
            description: A SPDIFRX interface interrupt is generated whenever SBD = 1 in the SPDIFRX_SR register.
            value: 1
      - name: SYNCDIE
        description: "Synchronization done\nThis bit is set and cleared by software."
        bitOffset: 5
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Interrupt is inhibited.
            value: 0
          - name: B_0x1
            description: A SPDIFRX interface interrupt is generated whenever SYNCD = 1 in the SPDIFRX_SR register.
            value: 1
      - name: IFEIE
        description: "Serial interface error interrupt enable\nThis bit is set and cleared by software."
        bitOffset: 6
        bitWidth: 1
        access: read-write
        enumeratedValues:
          - name: B_0x0
            description: Interrupt is inhibited.
            value: 0
          - name: B_0x1
            description: A SPDIFRX interface interrupt is generated whenever SERR = 1, TERR = 1, or FERR = 1 in the SPDIFRX_SR register.
            value: 1
  - name: SR
    displayName: SR
    description: Status register
    addressOffset: 8
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: RXNE
        description: "Read data register not empty\nThis bit is set by hardware when a valid data is available into SPDIFRX_FMTx_DR register.\nThis flag is cleared by reading the SPDIFRX_FMTx_DR register.\nAn interrupt is generated if RXNEIE=1 in the SPDIFRX_IMR register."
        bitOffset: 0
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: Data is not received.
            value: 0
          - name: B_0x1
            description: Received data is ready to be read.
            value: 1
      - name: CSRNE
        description: "Control buffer register not empty \nThis bit is set by hardware when a valid control information is ready. \nThis flag is cleared when reading SPDIFRX_CSR register.\nAn interrupt is generated if CBRDYIE = 1 in the SPDIFRX_IMR register."
        bitOffset: 1
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: No control word available on SPDIFRX_CSR register
            value: 0
          - name: B_0x1
            description: A control word is available on SPDIFRX_CSR register.
            value: 1
      - name: PERR
        description: "Parity error\nThis bit is set by hardware when the data and status bits of the sub-frame received contain an odd number of 0 and 1. \nThis flag is cleared by writing a 1 to its corresponding bit on SPDIFRX_IFCR register.\nAn interrupt is generated if PIE = 1 in the SPDIFRX_IMR register."
        bitOffset: 2
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: No parity error
            value: 0
          - name: B_0x1
            description: Parity error
            value: 1
      - name: OVR
        description: "Overrun error\nThis bit is set by hardware when a received data is ready to be transferred in the SPDIFRX_FMTx_DR register while RXNE = 1 and both SPDIFRX_FMTx_DR and RX_BUF are full.\nThis flag is cleared by writing a 1 to its corresponding bit on SPDIFRX_IFCR register.\nAn interrupt is generated if OVRIE=1 in the SPDIFRX_IMR register.\nNote: When this bit is set, the SPDIFRX_FMTx_DR register content is not lost but the last data received are."
        bitOffset: 3
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: No overrun error
            value: 0
          - name: B_0x1
            description: Overrun error is detected.
            value: 1
      - name: SBD
        description: "Synchronization block detected\nThis bit is set by hardware when a B preamble is detected. \nThis flag is cleared by writing a 1 to its corresponding bit on SPDIFRX_IFCR register. \nAn interrupt is generated if SBLKIE = 1 in the SPDIFRX_IMR register."
        bitOffset: 4
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: No B preamble is detected.
            value: 0
          - name: B_0x1
            description: B preamble is detected.
            value: 1
      - name: SYNCD
        description: "Synchronization done\nThis bit is set by hardware when the initial synchronization phase is properly completed. \nThis flag is cleared by writing a 1 to its corresponding bit on SPDIFRX_IFCR register.\nAn interrupt is generated if SYNCDIE = 1 in the SPDIFRX_IMR register."
        bitOffset: 5
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: Synchronization is pending.
            value: 0
          - name: B_0x1
            description: Synchronization is completed.
            value: 1
      - name: FERR
        description: "Framing error\nThis bit is set by hardware when an error occurs during data reception: such as preamble not at the expected place, short transition not grouped by pairs.\nThis is set by the hardware only if the synchronization is completed (SYNCD = 1).\nThis flag is cleared by writing SPDIFRXEN to 0.\nAn interrupt is generated if IFEIE=1 in the SPDIFRX_IMR register."
        bitOffset: 6
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: No Manchester violation detected
            value: 0
          - name: B_0x1
            description: Manchester violation detected
            value: 1
      - name: SERR
        description: "Synchronization error\nThis bit is set by hardware when the synchronization fails due to amount of re-tries for NBTR.\nThis flag is cleared by writing SPDIFRXEN to 0.\nAn interrupt is generated if IFEIE = 1 in the SPDIFRX_IMR register."
        bitOffset: 7
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: No synchronization error is detected.
            value: 0
          - name: B_0x1
            description: Synchronization error is detected.
            value: 1
      - name: TERR
        description: "Time-out error\nThis bit is set by hardware when the counter TRCNT reaches its max value. It indicates that the time interval between two transitions is too long. It generally indicates that there is no valid signal on SPDIFRX_IN input.\nThis flag is cleared by writing SPDIFRXEN to 0.\nAn interrupt is generated if IFEIE=1 in the SPDIFRX_IMR register."
        bitOffset: 8
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: No sequence error is detected.
            value: 0
          - name: B_0x1
            description: Sequence error is detected.
            value: 1
      - name: WIDTH5
        description: "duration of 5 symbols counted with spdifrx_ker_ck\nThis value represents the amount of spdifrx_ker_ck clock periods contained on a length of 5 consecutive symbols. This value can be used to estimate the S/PDIF symbol rate. Its accuracy is limited by the frequency of spdifrx_ker_ck.\nFor example if the spdifrx_ker_ck is fixed to 84 MHz, and WIDTH5 = 147d. The estimated sampling rate of the S/PDIF stream is:\nFs = 5 x F<sub>spdifrx_ker_ck</sub> / (WIDTH5 x 64) ~ 44.6 kHz, so the closest standard sampling rate is 44.1 kHz.\nNote that WIDTH5 is updated by the hardware when SYNCD goes high, and then every frame."
        bitOffset: 16
        bitWidth: 15
        access: read-only
  - name: IFCR
    displayName: IFCR
    description: Interrupt flag clear register
    addressOffset: 12
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: PERRCF
        description: "clears the parity error flag\nWriting 1 in this bit clears the flag PERR in the SPDIFRX_SR register.\nReading this bit always returns the value 0."
        bitOffset: 2
        bitWidth: 1
        access: write-only
      - name: OVRCF
        description: "clears the overrun error flag\nWriting 1 in this bit clears the flag OVR in the SPDIFRX_SR register.\nReading this bit always returns the value 0."
        bitOffset: 3
        bitWidth: 1
        access: write-only
      - name: SBDCF
        description: "clears the synchronization block detected flag\nWriting 1 in this bit clears the flag SBD in the SPDIFRX_SR register.\nReading this bit always returns the value 0."
        bitOffset: 4
        bitWidth: 1
        access: write-only
      - name: SYNCDCF
        description: "clears the synchronization done flag\nWriting 1 in this bit clears the flag SYNCD in the SPDIFRX_SR register.\nReading this bit always returns the value 0."
        bitOffset: 5
        bitWidth: 1
        access: write-only
  - name: FMT0_DR
    displayName: FMT0_DR
    description: Data input register
    addressOffset: 16
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: DR
        description: "data value\nContains the 24 received data bits, aligned on D[23]"
        bitOffset: 0
        bitWidth: 24
        access: read-only
      - name: PE
        description: "parity error bit\nContains a copy of PERR bit if PMSK = 0, otherwise it is forced to 0"
        bitOffset: 24
        bitWidth: 1
        access: read-only
      - name: V
        description: "validity bit\nContains the received validity bit if VMSK = 0, otherwise it is forced to 0"
        bitOffset: 25
        bitWidth: 1
        access: read-only
      - name: U
        description: "user bit\nContains the received user bit, if CUMSK = 0, otherwise it is forced to 0"
        bitOffset: 26
        bitWidth: 1
        access: read-only
      - name: C
        description: "channel status bit\nContains the received channel status bit, if CUMSK = 0, otherwise it is forced to 0"
        bitOffset: 27
        bitWidth: 1
        access: read-only
      - name: PT
        description: "preamble type\nThese bits indicate the preamble received.\nNote that if PTMSK = 1, this field is forced to zero"
        bitOffset: 28
        bitWidth: 2
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: not used
            value: 0
          - name: B_0x1
            description: Preamble B received
            value: 1
          - name: B_0x2
            description: Preamble M received
            value: 2
          - name: B_0x3
            description: Preamble W received
            value: 3
  - name: FMT0_DR_alternate1
    displayName: FMT0_DR_alternate1
    description: Data input register
    alternateRegister: FMT0_DR
    addressOffset: 16
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: PE
        description: "parity error bit\nContains a copy of PERR bit if PMSK = 0, otherwise it is forced to 0"
        bitOffset: 0
        bitWidth: 1
        access: read-only
      - name: V
        description: "validity bit\nContains the received validity bit if VMSK = 0, otherwise it is forced to 0"
        bitOffset: 1
        bitWidth: 1
        access: read-only
      - name: U
        description: "user bit\nContains the received user bit, if CUMSK = 0, otherwise it is forced to 0"
        bitOffset: 2
        bitWidth: 1
        access: read-only
      - name: C
        description: "channel Status bit\nContains the received channel status bit, if CUMSK = 0, otherwise it is forced to 0"
        bitOffset: 3
        bitWidth: 1
        access: read-only
      - name: PT
        description: "preamble type\nThese bits indicate the preamble received.\nNote that if PTMSK = 1, this field is forced to zero"
        bitOffset: 4
        bitWidth: 2
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: not used
            value: 0
          - name: B_0x1
            description: preamble B received
            value: 1
          - name: B_0x2
            description: preamble M received
            value: 2
          - name: B_0x3
            description: preamble W received
            value: 3
      - name: DR
        description: "data value\nContains the 24 received data bits, aligned on D[23]"
        bitOffset: 8
        bitWidth: 24
        access: read-only
  - name: FMT0_DR_alternate2
    displayName: FMT0_DR_alternate2
    description: Data input register
    alternateRegister: FMT0_DR
    addressOffset: 16
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: DRNL1
        description: "data value\nThis field contains the channel B"
        bitOffset: 0
        bitWidth: 16
        access: read-only
      - name: DRNL2
        description: "data value\nThis field contains the channel A"
        bitOffset: 16
        bitWidth: 16
        access: read-only
  - name: CSR
    displayName: CSR
    description: Channel status register
    addressOffset: 20
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: USR
        description: "user data information\nBit USR[0] is the oldest value, and comes from channel A, USR[1] comes channel B. \nSo USR[n] bits come from channel A is n is even, otherwise they come from channel B."
        bitOffset: 0
        bitWidth: 16
        access: read-only
      - name: CS
        description: "channel A status information\nBit CS[0] is the oldest value"
        bitOffset: 16
        bitWidth: 8
        access: read-only
      - name: SOB
        description: "start of block\nThis bit indicates if the bit CS[0] corresponds to the first bit of a new block"
        bitOffset: 24
        bitWidth: 1
        access: read-only
        enumeratedValues:
          - name: B_0x0
            description: CS[0] is not the first bit of a new block
            value: 0
          - name: B_0x1
            description: CS[0] is the first bit of a new block
            value: 1
  - name: DIR
    displayName: DIR
    description: Debug information register
    addressOffset: 24
    size: 32
    resetValue: 0
    resetMask: 4294967295
    fields:
      - name: THI
        description: "threshold HIGH (THI = 2.5 x UI / T<sub>spdifrx_ker_ck</sub>)\nThis field contains the current threshold HIGH estimation. This value can be used to estimate the sampling rate of the received stream. The accuracy of THI is limited to a period of the spdifrx_ker_ck. The sampling rate can be estimated as follow:\nSampling Rate = [2 x THI x T<sub>spdifrx_ker_ck </sub>+/- T<sub>spdifrx_ker_ck</sub>] x 2/5\nNote that THI is updated by the hardware when SYNCD goes high, and then every frame."
        bitOffset: 0
        bitWidth: 13
        access: read-only
      - name: TLO
        description: "threshold LOW (TLO = 1.5 x UI / T<sub>spdifrx_ker_ck</sub>)\nThis field contains the current threshold LOW estimation. This value can be used to estimate the sampling rate of the received stream. The accuracy of TLO is limited to a period of the spdifrx_ker_ck. The sampling rate can be estimated as follow:\nSampling Rate = [2 x TLO x T<sub>spdifrx_ker_ck </sub>+/- T<sub>spdifrx_ker_ck</sub>] x 2/3\nNote that TLO is updated by the hardware when SYNCD goes high, and then every frame."
        bitOffset: 16
        bitWidth: 13
        access: read-only
addressBlocks:
  - offset: 0
    size: 28
    usage: registers
interrupts:
  - name: INTR
    description: SPDIFRX global interrupt
