# CMake file for sodaCat test project
cmake_minimum_required(VERSION 3.28)

option(FOR_MODULES "Build with C++20 modules support" OFF)
if(FOR_MODULES)
    set(FILE_SET_TYPE CXX_MODULES)
    message(STATUS "Building with C++20 modules support")
else()
    set(FILE_SET_TYPE HEADERS)
    message(STATUS "Building without C++20 modules support")
endif()

set(CMAKE_CXX_STANDARD 20)

set(SODACAT_LOCAL_DIR "${CMAKE_SOURCE_DIR}/models")
list(APPEND CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake")
include(sodaCat)

add_library(soc-data-modules OBJECT)
target_include_directories(soc-data-modules PUBLIC ${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_SOURCE_DIR}/generators/cxx)
target_compile_definitions(soc-data-modules PUBLIC $<$<BOOL:${FOR_MODULES}>:REGISTERS_MODULE>)
set_target_properties(soc-data-modules PROPERTIES
    CXX_SCAN_FOR_MODULES ${FOR_MODULES}
    LINKER_LANGUAGE "CXX"
)

generate_header(soc-data-modules generate_chip_header stm32h7 ST/H7/H757/H757 .hpp)

generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/ADC .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/ADC_Common .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/DAC .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/DMA .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/DMAMUX1 .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/DMAMUX2 .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/MDMA .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/BDMA .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/GPIO .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/I2C .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/SAI .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/SPDIFRX .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/SYSCFG .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/EXTI .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/BasicTimer .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/GpTimer .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/AdvCtrlTimer .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/USART .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/LPTIM .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/LPTIMenc .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/RCC .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/QUADSPI .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/OPAMP .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/DFSDM .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/SPI .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/RTC .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/FMC .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/PWR .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/Flash .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/DBGMCU .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ST/H7/H757/ART .hpp)
generate_header(soc-data-modules generate_peripheral_header stm32h7 ARM/NVIC .hpp)

add_executable(soc-data-test main.cpp)
target_link_libraries(soc-data-test PRIVATE soc-data-modules)
target_compile_options(soc-data-test PUBLIC $<$<BOOL:${FOR_MODULES}>:-fmodules-ts>)
